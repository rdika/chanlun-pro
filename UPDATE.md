# 更新日志

---

### 2022-05-27

* 缠论计算修改
    * 增加分型包含配置：前分型包含后分型、后分型包含前分形（类似顶底包含配置）
    * 修复bug
* 批量计算多周期方法 batch_cls 转移到 cl_utils.py 文件中，并增加缓存
* WEB图表中计算缠论增加缓存，加速行情二次加载速度


### 2022-05-20

* 缠论计算修改
    * 增加笔分型成笔条件（是否允许 顶的最低点低于底分型最低点，底分型的最高点高于顶分型的最高点）
    * 增加获取 最后笔、线段中枢的 方法（get_last_bi_zs、get_last_xd_zs）
    * 增加中枢类型：方向性中枢

> 备注：
>
> 新增的缠论配置放在 cl_interface.py 文件中，不可在 web 页面中进行变更，默认为 False，与原来计算方式保持一致；
>
> 获取最后中枢是从最后一笔倒推的中枢，和原中枢计算的最后一个中枢会有差异；
>
> 方向性中枢：计算的中枢，进入与离开的方向一致（除最后一个未完成中枢）

* 支持掘金量化回测，并增加示例 [run.py](src/cl_myquant/run.py)
* 增加基于最后一个中枢的策略示例 [strategy_last_zs_3mmd.py](src/chanlun/strategy/strategy_last_zs_3mmd.py)

### 2022-05-13

* 缠论计算修改
    * 修改默认配置，分型包含为允许、笔中枢类型为标准、中枢位置关系为 zggdd
    * 类3买点逻辑优化
    * 多级别分析的类转移到 chanlun.cl_analyse.py 文件中
    * 修复计算bug
* 回测增加缠论参数优化功能，参看 [回测_缠论参数优化](notebook/回测_缠论参数优化.ipynb)
* online_market_datas.py 获取线上行情数据增加缓存，避免多次重复请求，需要手动调用 clear_cache 清除缓存
* 修复 行情回放练习 的bug

### 2022-05-06

* 缠论计算修改
    * 分型包含是否成笔处理逻辑bug修复
    * 二类买卖点，增加出中枢后不创新高/新低的买卖点提示
    * 修改分型强度计算方式
    * 增加走势类型中枢，以及走势类型买卖点
    * 三类买卖点的中枢判断，去除级别的限制

* 回测框架修改
    * 增加回测模式，分为：信号、交易、实盘 三类
    * 修改回测行情数据获取方式，通过基准代码，获取循环的时间列表，以此循环执行标的回测
    * **修改策略接收的缠论数据对象，CLDatas 变更为 MarketDatas，可获取除当前标的以外的数据，如 大盘指数 等**

* 策略新增与修改
    * 增加关于A股市场的交易策略 strategy_a_single_all_mmd.py，单周期，个人认为效果不理想，可以用来参考学习
    * 策略结果查看 [回测_沪深股票策略.ipynb](notebook/回测_沪深股票策略.ipynb)

* 行情图表在 Jupyterlab 环境可通过参数修改副图，来显示其他技术指标（暂不支持web）
* 修改行情图表显示订单记录的逻辑，不需要额外的时间转换
* 行情图表展示优化， 买卖点直接显示文字，更加直观；中枢颜色统一，笔中枢为白色，线段中枢为黄色，不在区分方向，之前的太花了
* 行情图表增加强分型提示
* 实盘交易示例修改，以适应新的回测运行方法
* VNPY 回测策略简化，更加方便对接项目中的策略并执行
* 增加从聚宽平台导出数据，之后在导入到本地数据库中，用于回测
* 其他bug修复

### 2022-04-29

**需要修改配置文件，参考 config.py.demo 进行更改**

**需要修改配置文件，参考 config.py.demo 进行更改**

**需要修改配置文件，参考 config.py.demo 进行更改**

```
    # 需要安装的包
    pip install alpaca-trade-api
    pip install polygon-api-client
    pip install MyTT
```

* 增加美股行情支持 @Jiang Haoquan 提供
* 交易所对象整理，所有交易所对象放在 exchange 包中，可在 config.py 中配置 web 所使用的各个市场交易所
* 增加更多选股条件设置，支持多周期选股，在 src/chanlun/xuangu/xuangu.py
* 回测图表优化
* 策略类 Strategy 增加一些策略中常用的方法（最后完成笔、强停顿、验证分型等等）
* 增加binance交易所获取K线数量，原 1000 到 1500 （数据库支持可到 2000）
* 重写多级别分解，可根据高级别笔、段，查找所包含的笔、段，并重新计算中枢，判断其中是否有背驰信息，参看 cl_interface.py
* 简单优化了下背驰策略
* 项目自带回测相关 bug 修复
* 代码优化 @Tim Lee 提供
    * 删除对keys()的不必要调用
    * 使用if表达式替换if语句
    * 使用items()直接解包字典值
    * 将重复代码提取到方法中
    * 调用itertools.product替换嵌套的for循环
    * 简化生成器表达式，用list extend替换 for append 循环
    * 用f-string替换interpolated string进行格式化
    * 使用next函数代替for循环
    * 简化序列长度比较
    * 将for循环转换为列表推导
    * 使用contextlib的suppress方法来消除错误
    * 删除保护条件后不必要的else
    * 合并嵌套if条件，将同一变量的多次比较替换为in运算符
    * 用 None 替换可变的默认参数
    * 使用any()代替for循环
    * 使用命名表达式来简化赋值和条件
    * 精简和重构部分代码

* 缠论计算修改
    * 个别配置下，线段计算错误
    * 中枢对象增加 macd 上穿下穿零轴，金叉死叉信息
    * 中枢振幅算法修改，改为中枢重叠区占整个中枢的百分比
    * 初始线段算法修改
    * 修复中枢位置计算bug，影响一二类买卖点

### 2022-04-16

* 完善相关安装文档（Windows、Ubuntu），简化Windows安装步骤
* 沪深行情获取不在使用富途（tick、板块信息和交易时间 数据还是需要富途才可正常获取）
* 沪深行情页面去掉根据时间获取的功能
* WEB图表增加简单画图功能，成交量与光标展示优化（感谢 @阿仔哥 提交的代码）
* **回测代码整理，相关文档 docs/缠论回测与交易指南.md**
* **实盘交易脚本整理，包括 沪深、港股、数字货币、期货市场；参看 docs/缠论回测与交易指南.md**
* **增加VNPY回测与实盘交易支持，文档参看 docs/vnpy使用指南.md**

### 2022-04-05

### chanlun-pro 项目更新

* 缠论核心 cl.py 代码加密并增加授权验证
* 增加本地选股脚本 script/xuangu.py，用于代替之前聚宽平台的选股功能
* 统一将页面缠论配置项收入到伸缩栏进行设置（页面中的两个图表使用同一套缠论配置）
* 缠论计算增加N项配置，详情参考页面设置

> cl.py 加密并打包，需要使用授权 licenses 文件才可使用；    
> 在 /src/pytransform 目录有一个试用 licenses 文件，将其复制并重命名为 license.lic 即可使用，有效期到 2022-04-12；    
> 请各位 VIP 将自己需要绑定的 mac 地址单独发我，给予生成授权文件；
> Windows 用户执行 getmac 命令获取；Linux、MacOS 执行 ifconfig 命令获取；
>
> 增加了多个缠论配置项，任务配置需要重新设置并保存才可生效

### 2022-03-25

### chanlun-pro 项目更新

* 缠论中枢增加 段内中枢 功能，在线段内查找并标识笔中枢
* 增加中枢区间配置，可设置 实际高低 与 顶底端点 两个配置，用来计算 中枢高低点
* 增加趋势线，按照线段的特征序列计算得来的趋势线
* LINE (BI/XD) 对象的 high、low 修改为实际的高低点，增加 ding_high() di_low() 方法获取端点的高低点
* 去除了线段是否完成的配置
* 画图优化，深色爱护眼睛模式，未完成笔、线段、趋势，使用虚线标识
* 优化指标计算，根据设置的最大值，来获取计算的价格序列，均线参数等可设置大于100的值
* 修复 bi.done 不更新的 bug
* 修复 中枢 zg、zd 计算错误 bug
* 回测的 notebook 实例优化，简化了代码，可直接调取封装的方法，参考 回测_数字货币策略.ipynb
* 修改了 Strategy 策略的两个方法名，修改为 open、close 更好理解其功能
* 增加港股的任务配置
* 简单完善了写策略编写文档：BACK_TEST.md

### chanlun 同步更新以上 缠论计算 功能

### 2022-03-22

### chanlun-pro 项目更新

* 缠论线段计算 bug 修复
* 将港股与沪深股市分开两个页面展示
* 图表高度在（沪深、港股、期货）可单独设置大图或小图

> 需要在 config.py 中增加 香港股票自选分组 配置

*chanlun 项目统一周五更新*

## 2022-03-20

### chanlun-pro 项目更新

* 股票列表通过 通达信 获取
* 增加股票行情获取条数，原来 800 条增加到现在的 2400 条

> 需要重新安装 pytdx 包   
> pip3 uninstall pytdx   
> pip3 install wheel   
> pip3 install package/pytdx-1.72r2-py3-none-any.whl

## 2022-03-18

### chanlun 项目更新

* 增加线段中枢以及线段买卖点
* 画图展示优化
* 增加多个参数（缠论、画图），可按需自定使用

具体可参考：https://github.com/yijixiuxin/chanlun/tree/main/example

### chanlun-pro 项目更新

* 图表增加均线
* 增加页面可定义指标参数设置
* 增加画图自定义展示开关
* 任务配置监控，增加线段的背驰与买卖点监控
